<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Calendario Académico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;70s0&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        .close-button {
            float: right;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #9ca3af;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .month-card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        .month-header {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            text-align: center;
        }
        .day-header {
            font-weight: bold;
            color: #6b7280;
        }
        .day {
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .day:hover {
            background-color: #e5e7eb;
        }
        .day.selected {
            background-color: #93c5fd; /* Blue-300 */
            color: #1e40af; /* Blue-900 */
            font-weight: bold;
        }
        .day.feriado {
            background-color: #fca5a5; /* Red-300 */
            color: #991b1b; /* Red-900 */
            font-weight: bold;
        }
        .day.festivo {
            background-color: #fde68a; /* Yellow-300 */
            color: #92400e; /* Yellow-900 */
            font-weight: bold;
        }
        .day.parcial {
            background-color: #6ee7b7; /* Green-300 */
            color: #065f46; /* Green-900 */
            font-weight: bold;
        }
        .day.payment-due {
            background-color: #a78bfa; /* Purple-300 */
            color: #4c1d95; /* Purple-900 */
            font-weight: bold;
        }
        .day.today {
            border: 2px solid #2563eb;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div class="container">
        <h1 class="text-4xl font-bold text-center mb-8 text-blue-800">Calendario Académico</h1>
        <div class="flex justify-center gap-4 mt-6">
    <a href="Superclases.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
      <strong>inicio</strong>
    </a>
  </div><br>
        <!-- Nuevo panel de estado de pago -->
        <div id="paymentStatus" class="card text-center text-lg font-semibold mb-8">
            <!-- El estado del pago se mostrará aquí -->
        </div>

        <!-- Seccion para seleccionar numero de clases -->
        <div class="card mb-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Control de Clases y Pagos</h2>
            <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-8">
                <div class="flex-1 w-full">
                    <label for="numClasses" class="block text-sm font-medium text-gray-700 mb-2">
                        ¿Cuántas clases tomas en el nuevo periodo?
                    </label>
                    <select id="numClasses" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1">1 clase</option>
                        <option value="2">2 clases</option>
                        <option value="3">3 clases</option>
                        <option value="4">4 clases</option>
                        <option value="5">5 clases</option>
                    </select>
                </div>
                <div class="flex-1 w-full text-center md:text-left">
                    <p class="text-sm text-gray-700">Costo de la clase:</p>
                    <p id="classCost" class="text-xl font-bold text-green-600">L. 500</p>
                </div>
            </div>
        </div>

        <div class="flex justify-center items-center space-x-4 mb-8">
            <button onclick="changeYear(-1)" class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-all focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <span id="currentYearDisplay" class="text-2xl font-bold">2025</span>
            <button onclick="changeYear(1)" class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-all focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
        
        <div class="calendar-grid" id="calendarGrid">
            <!-- Calendario de meses se generará aquí -->
        </div>

        <div class="mt-12">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Periodos Académicos</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Periodo I -->
                <div class="card bg-gradient-to-br from-blue-100 to-blue-200">
                    <h2 class="text-2xl font-semibold mb-4 text-blue-900">Periodo I</h2>
                    <p class="text-sm text-gray-700 mb-2"><strong>INICIO:</strong> 06 de enero</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>FIN:</strong> 22 de marzo</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>I PARCIAL:</strong> 27 de ene. al 02 de feb.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>II PARCIAL:</strong> 24 de feb. al 02 de mar.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>III PARCIAL:</strong> 10 al 16 de mar.</p>
                </div>
                
                <!-- Periodo II -->
                <div class="card bg-gradient-to-br from-green-100 to-green-200">
                    <h2 class="text-2xl font-semibold mb-4 text-green-900">Periodo II</h2>
                    <p class="text-sm text-gray-700 mb-2"><strong>INICIO:</strong> 31 de marzo de 2025</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>FIN:</strong> 22 de junio de 2025</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>I PARCIAL:</strong> 28 de abr. al 04 de may.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>II PARCIAL:</strong> 26 de may. al 01 de jun.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>III PARCIAL:</strong> 09 al 15 de jun.</p>
                </div>
                
                <!-- Periodo III -->
                <div class="card bg-gradient-to-br from-yellow-100 to-yellow-200">
                    <h2 class="text-2xl font-semibold mb-4 text-yellow-900">Periodo III</h2>
                    <p class="text-sm text-gray-700 mb-2"><strong>INICIO:</strong> 30 de junio de 2025</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>FIN:</strong> 14 de septiembre de 2025</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>I PARCIAL:</strong> 21 al 27 de jul.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>II PARCIAL:</strong> 18 al 24 de ago.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>III PARCIAL:</strong> 01 al 07 de sept.</p>
                </div>
                
                <!-- Periodo IV -->
                <div class="card bg-gradient-to-br from-purple-100 to-purple-200">
                    <h2 class="text-2xl font-semibold mb-4 text-purple-900">Periodo IV</h2>
                    <p class="text-sm text-gray-700 mb-2"><strong>INICIO:</strong> 22 de septiembre de 2025</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>FIN:</strong> 14 de diciembre de 2025</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>I PARCIAL:</strong> 20 al 26 de oct.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>II PARCIAL:</strong> 17 al 23 de nov.</p>
                    <p class="text-sm text-gray-700 mb-2"><strong>III PARCIAL:</strong> 01 al 07 de dic.</p>
                </div>
            </div>
        </div>

        <!-- Seccion de cuentas bancarias -->
        <div class="card mt-12">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Cuentas Bancarias para Pago</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold text-lg text-gray-700">Davienda Ch</h3>
                    <p class="text-gray-600">2081227815</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-gray-700">BanTrab Ch</h3>
                    <p class="text-gray-600">112020018694</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-gray-700">BAC Ch</h3>
                    <p class="text-gray-600">730198531</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-gray-700">Atlántida Ch</h3>
                    <p class="text-gray-600">120-11100110-9</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-gray-700">Banpais Ch</h3>
                    <p class="text-gray-600">01-345-000309-6</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-gray-700">Banrural Ch</h3>
                    <p class="text-gray-600">015-0301-011512-5</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para recordatorios y detalles -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
            <p id="modalMessage" class="mb-2"></p>
            <div id="modalCostBreakdown" class="text-left mb-6 p-4 bg-gray-100 rounded-lg"></div>
            <div id="modalButtons" class="flex justify-center space-x-4"></div>
        </div>
    </div>

    <script>
        // Data para los calendarios de 2025, 2026, 2027 y 2028
       const calendarEvents = {
    2025: {
        academicPeriods: [
            { name: 'Periodo I', start: '2025-01-06', end: '2025-03-22', color: 'blue' },
            { name: 'Periodo II', start: '2025-03-31', end: '2025-06-22', color: 'green' },
            { name: 'Periodo III', start: '2025-06-30', end: '2025-09-14', color: 'yellow' },
            { name: 'Periodo IV', start: '2025-09-22', end: '2025-12-14', color: 'purple' },
        ],
        parciales: [
            { date: '2025-02-02', name: 'I Parcial (Periodo I)' },
            { date: '2025-03-02', name: 'II Parcial (Periodo I)' },
            { date: '2025-03-16', name: 'III Parcial (Periodo I)' },

            { date: '2025-04-28', name: 'I Parcial (Periodo II)' },
            { date: '2025-05-26', name: 'II Parcial (Periodo II)' },
            { date: '2025-06-09', name: 'III Parcial (Periodo II)' },

            { date: '2025-07-21', name: 'I Parcial (Periodo III)' },
            { date: '2025-08-18', name: 'II Parcial (Periodo III)' },
            { date: '2025-09-01', name: 'III Parcial (Periodo III)' },

            { date: '2025-10-20', name: 'I Parcial (Periodo IV)' },
            { date: '2025-11-17', name: 'II Parcial (Periodo IV)' },
            { date: '2025-12-01', name: 'III Parcial (Periodo IV)' }
        ],
        holidays: [
            { date: '2025-01-01', name: 'Día de Año Nuevo' },
            { date: '2025-04-14', name: 'Lunes Santo' },
            { date: '2025-04-15', name: 'Martes Santo' },
            { date: '2025-04-16', name: 'Miércoles Santo' },
            { date: '2025-04-17', name: 'Jueves Santo' },
            { date: '2025-04-18', name: 'Viernes Santo' },
            { date: '2025-04-19', name: 'Sábado de Gloria' },
            { date: '2025-04-20', name: 'Domingo de Resurrección' },
            { date: '2025-05-01', name: 'Día del Trabajo' },
            { date: '2025-09-15', name: 'Día de la Independencia' },
            { date: '2025-09-29', name: 'Inicio del Feriado Morazánico' },
            { date: '2025-10-05', name: 'Fin del Feriado Morazánico' },
            { date: '2025-12-25', name: 'Día de Navidad' }
        ],
        festiveDays: [
            { date: '2025-02-14', name: 'Día de San Valentín' },
            { date: '2025-05-10', name: 'Día de la Madre' },
            { date: '2025-06-21', name: 'Día del Padre' },
        ],
        paymentDates: [
            '2025-02-06', '2025-03-06', '2025-03-21',
            '2025-05-06', '2025-06-06', '2025-06-21',
            '2025-08-06', '2025-09-06', '2025-09-21',
            '2025-11-06', '2025-12-06', '2025-12-21',
        ]
    },

    2026: {
        academicPeriods: [
            { name: 'Periodo I', start: '2026-01-05', end: '2026-03-21', color: 'blue' },
            { name: 'Periodo II', start: '2026-03-30', end: '2026-06-21', color: 'green' },
            { name: 'Periodo III', start: '2026-06-29', end: '2026-09-13', color: 'yellow' },
            { name: 'Periodo IV', start: '2026-09-21', end: '2026-12-13', color: 'purple' },
        ],
        parciales: [
            { date: '2026-01-26', name: 'I Parcial (Periodo I)' },
            { date: '2026-02-23', name: 'II Parcial (Periodo I)' },
            { date: '2026-03-09', name: 'III Parcial (Periodo I)' },

            { date: '2026-04-27', name: 'I Parcial (Periodo II)' },
            { date: '2026-05-25', name: 'II Parcial (Periodo II)' },
            { date: '2026-06-08', name: 'III Parcial (Periodo II)' },

            { date: '2026-07-20', name: 'I Parcial (Periodo III)' },
            { date: '2026-08-17', name: 'II Parcial (Periodo III)' },
            { date: '2026-08-31', name: 'III Parcial (Periodo III)' },

            { date: '2026-10-19', name: 'I Parcial (Periodo IV)' },
            { date: '2026-11-16', name: 'II Parcial (Periodo IV)' },
            { date: '2026-11-30', name: 'III Parcial (Periodo IV)' }
        ],
        holidays: [
            { date: '2026-01-01', name: 'Día de Año Nuevo' },
            { date: '2026-03-30', name: 'Lunes Santo' },
            { date: '2026-03-31', name: 'Martes Santo' },
            { date: '2026-04-01', name: 'Miércoles Santo' },
            { date: '2026-04-02', name: 'Jueves Santo' },
            { date: '2026-04-03', name: 'Viernes Santo' },
            { date: '2026-04-04', name: 'Sábado de Gloria' },
            { date: '2026-04-05', name: 'Domingo de Resurrección' },
            { date: '2026-05-01', name: 'Día del Trabajo' },
            { date: '2026-09-15', name: 'Día de la Independencia' },
            { date: '2026-10-05', name: 'Feriado Morazánico (inicio)' },
            { date: '2026-10-11', name: 'Feriado Morazánico (fin)' },
            { date: '2026-12-25', name: 'Día de Navidad' }
        ],
        festiveDays: [
            { date: '2026-02-14', name: 'Día de San Valentín' },
            { date: '2026-05-10', name: 'Día de la Madre' },
            { date: '2026-06-21', name: 'Día del Padre' },
        ],
        paymentDates: [
            '2026-02-06', '2026-03-06', '2026-03-21',
            '2026-05-06', '2026-06-06', '2026-06-21',
            '2026-08-06', '2026-09-06', '2026-09-21',
            '2026-11-06', '2026-12-06', '2026-12-21',
        ]
    },

    2027: {
        academicPeriods: [
            { name: 'Periodo I', start: '2027-01-04', end: '2027-03-20', color: 'blue' },
            { name: 'Periodo II', start: '2027-03-29', end: '2027-06-20', color: 'green' },
            { name: 'Periodo III', start: '2027-06-28', end: '2027-09-12', color: 'yellow' },
            { name: 'Periodo IV', start: '2027-09-20', end: '2027-12-12', color: 'purple' },
        ],
        parciales: [
            { date: '2027-01-25', name: 'I Parcial (Periodo I)' },
            { date: '2027-02-22', name: 'II Parcial (Periodo I)' },
            { date: '2027-03-08', name: 'III Parcial (Periodo I)' },

            { date: '2027-04-26', name: 'I Parcial (Periodo II)' },
            { date: '2027-05-24', name: 'II Parcial (Periodo II)' },
            { date: '2027-06-07', name: 'III Parcial (Periodo II)' },

            { date: '2027-07-19', name: 'I Parcial (Periodo III)' },
            { date: '2027-08-16', name: 'II Parcial (Periodo III)' },
            { date: '2027-08-30', name: 'III Parcial (Periodo III)' },

            { date: '2027-10-18', name: 'I Parcial (Periodo IV)' },
            { date: '2027-11-15', name: 'II Parcial (Periodo IV)' },
            { date: '2027-11-29', name: 'III Parcial (Periodo IV)' }
        ],
        holidays: [
            { date: '2027-01-01', name: 'Día de Año Nuevo' },
            { date: '2027-03-22', name: 'Lunes Santo' },
            { date: '2027-03-23', name: 'Martes Santo' },
            { date: '2027-03-24', name: 'Miércoles Santo' },
            { date: '2027-03-25', name: 'Jueves Santo' },
            { date: '2027-03-26', name: 'Viernes Santo' },
            { date: '2027-03-27', name: 'Sábado de Gloria' },
            { date: '2027-03-28', name: 'Domingo de Resurrección' },
            { date: '2027-05-01', name: 'Día del Trabajo' },
            { date: '2027-09-15', name: 'Día de la Independencia' },
            { date: '2027-10-04', name: 'Feriado Morazánico (inicio)' },
            { date: '2027-10-10', name: 'Feriado Morazánico (fin)' },
            { date: '2027-12-25', name: 'Día de Navidad' }
        ],
        festiveDays: [
            { date: '2027-02-14', name: 'Día de San Valentín' },
            { date: '2027-05-10', name: 'Día de la Madre' },
            { date: '2027-06-21', name: 'Día del Padre' },
        ],
        paymentDates: [
            '2027-02-06', '2027-03-06', '2027-03-20',
            '2027-05-06', '2027-06-06', '2027-06-20',
            '2027-08-06', '2027-09-06', '2027-09-20',
            '2027-11-06', '2027-12-06', '2027-12-20',
        ]
    },

    2028: {
        academicPeriods: [
            { name: 'Periodo I', start: '2028-01-03', end: '2028-03-19', color: 'blue' },
            { name: 'Periodo II', start: '2028-03-27', end: '2028-06-18', color: 'green' },
            { name: 'Periodo III', start: '2028-06-26', end: '2028-09-10', color: 'yellow' },
            { name: 'Periodo IV', start: '2028-09-18', end: '2028-12-10', color: 'purple' },
        ],
        parciales: [
            { date: '2028-01-24', name: 'I Parcial (Periodo I)' },
            { date: '2028-02-21', name: 'II Parcial (Periodo I)' },
            { date: '2028-03-06', name: 'III Parcial (Periodo I)' },

            { date: '2028-04-24', name: 'I Parcial (Periodo II)' },
            { date: '2028-05-22', name: 'II Parcial (Periodo II)' },
            { date: '2028-06-05', name: 'III Parcial (Periodo II)' },

            { date: '2028-07-17', name: 'I Parcial (Periodo III)' },
            { date: '2028-08-14', name: 'II Parcial (Periodo III)' },
            { date: '2028-08-28', name: 'III Parcial (Periodo III)' },

            { date: '2028-10-16', name: 'I Parcial (Periodo IV)' },
            { date: '2028-11-13', name: 'II Parcial (Periodo IV)' },
            { date: '2028-11-27', name: 'III Parcial (Periodo IV)' }
        ],
        holidays: [
            { date: '2028-01-01', name: 'Día de Año Nuevo' },
            { date: '2028-04-10', name: 'Lunes Santo' },
            { date: '2028-04-11', name: 'Martes Santo' },
            { date: '2028-04-12', name: 'Miércoles Santo' },
            { date: '2028-04-13', name: 'Jueves Santo' },
            { date: '2028-04-14', name: 'Viernes Santo' },
            { date: '2028-04-15', name: 'Sábado de Gloria' },
            { date: '2028-04-16', name: 'Domingo de Resurrección' },
            { date: '2028-05-01', name: 'Día del Trabajo' },
            { date: '2028-09-15', name: 'Día de la Independencia' },
            { date: '2028-10-02', name: 'Feriado Morazánico' },
            { date: '2028-10-08', name: 'Feriado Morazánico' },
            { date: '2028-10-08', name: 'Feriado Morazánico' },
            { date: '2028-12-25', name: 'Día de Navidad' }
        ],
        festiveDays: [
            { date: '2028-02-14', name: 'Día de San Valentín' },
            { date: '2028-05-10', name: 'Día de la Madre' },
            { date: '2028-06-21', name: 'Día del Padre' },
        ],
        paymentDates: [
            '2028-02-06', '2028-03-06', '2028-03-19',
            '2028-05-06', '2028-06-06', '2028-06-18',
            '2028-08-06', '2028-09-06', '2028-09-18',
            '2028-11-06', '2028-12-06', '2028-12-18',
        ]
    }
};



        const paymentPeriods = {
            2025: ['Periodo I', 'Periodo II', 'Periodo III', 'Periodo IV'],
            2026: ['Periodo I', 'Periodo II', 'Periodo III', 'Periodo IV'],
            2027: ['Periodo I', 'Periodo II', 'Periodo III', 'Periodo IV'],
            2028: ['Periodo I', 'Periodo II', 'Periodo III', 'Periodo IV']
        };

        const classCosts = {
            1: 500,
            2: 750,
            3: 1100,
            4: 1250,
            5: 1600
        };

        const matriculationCost = 1200;

        let lastPaidPeriod = localStorage.getItem('lastPaidPeriod') || null;
        let numClasses = localStorage.getItem('numClasses') || 1;
        let currentYear = new Date().getFullYear();


        // === DETECTAR EL PERIODO ACADÉMICO ACTUAL ===
function getCurrentPeriod() {
    const today = new Date();
    const yearEvents = calendarEvents[today.getFullYear()];
    if (!yearEvents) return null;

    const period = yearEvents.academicPeriods.find(p => {
        const start = new Date(p.start);
        const end = new Date(p.end);
        return today >= start && today <= end;
    });

    return period ? `${period.name} ${today.getFullYear()}` : null;
}

  // === FUNCIÓN PARA MOSTRAR SOLO PAGOS PENDIENTES Y EDITARLOS ===
function checkPaymentStatus() {
    const year = currentYear;
    const yearEvents = calendarEvents[year];
    if (!yearEvents) return;

    const numClasses = parseInt(localStorage.getItem('numClasses') || 1, 10);
    const baseCost = classCosts[numClasses] || 0;

    let html = `<h2 class="text-xl font-bold mb-4">Pagos Pendientes ${year}</h2>`;

    let hasPending = false;

    yearEvents.paymentDates.forEach(dateStr => {
        const date = new Date(dateStr);
        const day = date.getDate();
        const month = date.toLocaleString('es-ES', { month: 'long' });

        let pagoTipo = "Mensualidad";
        let totalPago = baseCost;

        if (day === 21) {
            pagoTipo = "Mensualidad + Matrícula";
            totalPago += matriculationCost;
        }

        const pagoKey = `${year}-${String(date.getMonth()+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        const estadoPago = localStorage.getItem(`pago-${pagoKey}`) || "pendiente";

        if (estadoPago === "pendiente") {
            hasPending = true;
            html += `
                <div class="flex justify-between items-center bg-red-50 border border-red-200 rounded-lg p-2 mb-2">
                    <span><b>${day} de ${month}</b> — ${pagoTipo} (${totalPago} Lps)</span>
                    <button 
                        class="bg-green-600 text-white py-1 px-3 rounded hover:bg-green-700 transition-all"
                        onclick="marcarPago('${pagoKey}')">
                        Marcar como pagado
                    </button>
                </div>
            `;
        }
    });

    if (!hasPending) {
        html += `<p class="text-green-600 font-semibold">¡Felicidades! No tienes pagos pendientes.</p>`;
    }

    paymentStatusDiv.innerHTML = html;
}

// === FUNCIÓN PARA MARCAR PAGO COMO PAGADO ===
function marcarPago(pagoKey) {
    localStorage.setItem(`pago-${pagoKey}`, "pagado");
    checkPaymentStatus(); // refrescar la lista
}

        // Elementos del modal
        const modal = document.getElementById('myModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCostBreakdown = document.getElementById('modalCostBreakdown');
        const modalButtons = document.getElementById('modalButtons');
        const closeButton = document.querySelector('.close-button');
        const calendarGrid = document.getElementById('calendarGrid');
        const currentYearDisplay = document.getElementById('currentYearDisplay');
        const paymentStatusDiv = document.getElementById('paymentStatus');
        const numClassesSelect = document.getElementById('numClasses');
        const classCostDisplay = document.getElementById('classCost');

        function showModal(title, message, buttons, breakdownHTML = '') {
    modalTitle.textContent = title;
    modalMessage.innerHTML = message;  // ✅ ahora sí interpreta etiquetas HTML
    modalCostBreakdown.innerHTML = breakdownHTML;
    modalButtons.innerHTML = '';
    if (buttons) {
        buttons.forEach(btn => {
            const buttonElement = document.createElement('button');
            buttonElement.className = btn.class || 'bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-all';
            buttonElement.textContent = btn.text;
            buttonElement.onclick = btn.onClick;
            modalButtons.appendChild(buttonElement);
        });
    }
    modal.style.display = 'flex';
}


        // Función para ocultar el modal
        function hideModal() {
            modal.style.display = 'none';
        }

        closeButton.onclick = hideModal;
        window.onclick = function(event) {
            if (event.target == modal) {
                hideModal();
            }
        };

        // Función para cambiar el año
        function changeYear(offset) {
            currentYear += offset;
            localStorage.setItem('calendarYear', currentYear);
            renderCalendar(currentYear);
            checkPaymentStatus();
        }

        // Reemplaza por completo la función renderCalendar original por esta:
function renderCalendar(year) {
    try {
        currentYearDisplay.textContent = year;
        calendarGrid.innerHTML = '';
        const today = new Date();
        const yearEvents = calendarEvents[year];
        if (!yearEvents) {
            calendarGrid.innerHTML = `<div class="text-center text-gray-500 col-span-full">No hay datos de calendario para el año ${year}.</div>`;
            return;
        }

        const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

        for (let month = 0; month < 12; month++) {
            const date = new Date(year, month, 1);
            const firstDay = date.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const monthCard = document.createElement('div');
            monthCard.className = 'month-card';

            let monthHTML = `<div class="month-header">${monthNames[month]} ${year}</div>`;
            monthHTML += `<div class="calendar-days"><div class="day-header">Lun</div><div class="day-header">Mar</div><div class="day-header">Mié</div><div class="day-header">Jue</div><div class="day-header">Vie</div><div class="day-header">Sáb</div><div class="day-header">Dom</div>`;

            // Días vacíos para el inicio del mes (usar clase 'empty' para que no respondan como evento)
            let startDay = (firstDay === 0) ? 6 : firstDay - 1;
            for (let i = 0; i < startDay; i++) {
                monthHTML += `<div class="day empty"></div>`;
            }

            // Días del mes
            for (let day = 1; day <= daysInMonth; day++) {
                const fullDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                let classes = 'day';
                let eventName = '';
                let eventMessage = '';

                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    classes += ' today';
                }

                const isParcial = Array.isArray(yearEvents.parciales) && yearEvents.parciales.find(p => p.date === fullDate);
                const isHoliday = Array.isArray(yearEvents.holidays) && yearEvents.holidays.find(h => h.date === fullDate);
                const isFestive = Array.isArray(yearEvents.festiveDays) && yearEvents.festiveDays.find(f => f.date === fullDate);
                const isPaymentDue = Array.isArray(yearEvents.paymentDates) && yearEvents.paymentDates.includes(fullDate);

                if (isParcial) {
                    classes += ' parcial';
                    eventName = isParcial.name;
                    eventMessage = `¡Atención! fin del parcial: ${eventName}.`;
                }
                if (isHoliday) {
                    classes += ' feriado';
                    eventName = isHoliday.name;
                    eventMessage = `¡Feriado este dia!,   ${eventName}.`;
                }
                if (isFestive) {
                    classes += ' festivo';
                    eventName = isFestive.name;
                    eventMessage = `¡Día festivo! Es el ${eventName}.`;
                }
                if (isPaymentDue) {
                    classes += ' payment-due';
                    // Determinar tipo de pago según el día del mes (evita usar variable indefinida)
                    const dayOfMonth = new Date(fullDate).getDate();
                    let pagoTipoLocal = 'Mensualidad';
                    if (dayOfMonth === 21) {
                        pagoTipoLocal = 'Mensualidad + Matrícula';
                    } else if (dayOfMonth === 6) {
                        pagoTipoLocal = 'Mensualidad';
                    }
                    eventName = `Fecha de pago: ${pagoTipoLocal}`;
                    eventMessage = `¡Recuerda! Es la fecha límite de ${pagoTipoLocal}.`;
                }

                monthHTML += `<div class="${classes}" data-date="${fullDate}" data-event="${eventName}" data-event-message="${eventMessage}">${day}</div>`;
            }

            monthHTML += `</div>`;
            monthCard.innerHTML = monthHTML;
            calendarGrid.appendChild(monthCard);
        }

        // Sólo abrir modal si el día tiene un eventName (evita abrirlo para casillas vacías)
        document.querySelectorAll('.day').forEach(dayElement => {
            dayElement.onclick = () => {
                const eventName = dayElement.getAttribute('data-event');
                const eventMessage = dayElement.getAttribute('data-event-message');
                if (eventName && eventName.trim() !== '') {
                    showModal('Información del Día', eventMessage || eventName);
                }
            };
        });
    } catch (err) {
        console.error('Error en renderCalendar:', err);
        calendarGrid.innerHTML = `<div class="text-center text-red-600 col-span-full">Ocurrió un error al cargar el calendario. Mira la consola para más detalles.</div>`;
    }
}

        
        // === FUNCIÓN PARA CALCULAR Y GUARDAR COSTO DE CLASES ===
 // Función para calcular el costo de las clases
        function calculateClassCost() {
            const selectedClasses = parseInt(numClassesSelect.value, 10);
            localStorage.setItem('numClasses', selectedClasses);
            const cost = classCosts[selectedClasses] || 0;
            classCostDisplay.textContent = `L. ${cost}`;
            return cost;
        }

        // === NUEVA FUNCIÓN PARA BUSCAR EL PRÓXIMO PAGO ===
        // === NUEVA FUNCIÓN PARA BUSCAR EL PRÓXIMO PAGO ===
function getNextPaymentDate() {
    const today = new Date();
    let year = today.getFullYear();

    for (let offset = 0; offset < 2; offset++) { // año actual + 1
        const yearEvents = calendarEvents[year + offset];
        if (!yearEvents || !Array.isArray(yearEvents.paymentDates)) continue;

        const futurePayments = yearEvents.paymentDates
            .map(d => new Date(d))
            .filter(d => d >= today)
            .sort((a, b) => a - b);

        if (futurePayments.length > 0) return futurePayments[0];
    }
    return null;
}


// === FUNCIÓN PARA MOSTRAR EL RECORDATORIO DE PAGO ===
// === FUNCIÓN PARA RECORDATORIO EMERGENTE ===
function showPaymentReminder() {
    const nextPayment = getNextPaymentDate();
    if (!nextPayment) return;

    const today = new Date();
    const diffDays = Math.ceil((nextPayment - today) / (1000 * 60 * 60 * 24));

    const day = nextPayment.getDate();
    const month = nextPayment.toLocaleString('es-ES', { month: 'long' });

    // Obtener número de clases
    const numClasses = parseInt(localStorage.getItem('numClasses') || 1, 10);
    const baseCost = classCosts[numClasses] || 0;

    // Determinar tipo de pago
    let pagoTipo = "Mensualidad";
    let totalPago = baseCost;
    if (day === 21) {
        pagoTipo = "Mensualidad + Matrícula";
        totalPago += matriculationCost;
    }

    const pagoKey = `${nextPayment.getFullYear()}-${String(nextPayment.getMonth()+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const estadoPago = localStorage.getItem(`pago-${pagoKey}`);

    if (estadoPago === "pagado") return;

    const breakdownHTML = `
        <div class="p-3 bg-gray-100 rounded-lg text-left">
            <p><b>Clases:</b> ${numClasses} (${baseCost} Lps)</p>
            ${day === 21 ? `<p><b>Matrícula:</b> ${matriculationCost} Lps</p>` : ""}
            <hr class="my-2">
            <p><b>Total a pagar:</b> ${totalPago} Lps</p>
        </div>
    `;

    showModal(
        "Recordatorio de Pago",
        `El próximo pago de <b>${pagoTipo}</b> es el <b>${day} de ${month}</b> (${diffDays} días restantes).`,
        [
            {
                text: "Ya pagué",
                class: "bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-all",
                onClick: () => {
                    localStorage.setItem(`pago-${pagoKey}`, "pagado");
                    hideModal();
                    checkPaymentStatus();
                }
            },
            {
                text: "No he pagado",
                class: "bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-all",
                onClick: () => {
                    localStorage.setItem(`pago-${pagoKey}`, "pendiente");
                    hideModal();
                    checkPaymentStatus();
                    setInterval(() => {
                        showPaymentReminder();
                    }, 5 * 60 * 60 * 1000);
                }
            }
        ],
        breakdownHTML
    );
}


// === LLAMADA AUTOMÁTICA AL INICIAR LA APP ===
// Verificar los recordatorios al cargar la página
        window.onload = function() {
            const today = new Date();
            const yearFromLocalStorage = localStorage.getItem('calendarYear');
            currentYear = yearFromLocalStorage ? parseInt(yearFromLocalStorage) : today.getFullYear();
            
            const classesFromLocalStorage = localStorage.getItem('numClasses');
            if (classesFromLocalStorage) {
                numClassesSelect.value = classesFromLocalStorage;
            }
            numClassesSelect.addEventListener('change', () => {
                calculateClassCost();
                checkPaymentStatus();
            });
            calculateClassCost();
            renderCalendar(currentYear);
            checkPaymentStatus();
            // Configurar un intervalo para revisar recordatorios cada día
            setInterval(checkPaymentStatus, 1000 * 60 * 60 * 24); 
        };
    </script>
</body>
</html>
