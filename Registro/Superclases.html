<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Estudios - Ingeniería en Sistemas Computacionales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos generales para un tema oscuro profesional y elegante */
        body {
            background-color: #1c1c1c; /* Fondo más oscuro y uniforme, similar a interfaces profesionales */
            color: #e0e0e0; /* Texto claro para alto contraste */
            font-family: 'Segoe UI', 'Inter', sans-serif; /* Preferencia por 'Segoe UI' para estética Microsoft */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px; /* Un poco más ancho para una distribución más limpia */
            margin: 0 auto;
            padding: 2.5rem; /* Más padding general */
            flex-grow: 1;
            width: 100%;
            box-sizing: border-box;
        }

        h1, h2 {
            color: #8ab4f8; /* Azul claro para títulos, vibrante pero profesional */
            font-weight: 600; /* Menos bold para una sensación más ligera */
        }

        h1 {
            font-size: 2.5rem; /* Título principal más grande */
            letter-spacing: -0.025em; /* Ligeramente más apretado */
            margin-bottom: 1.5rem;
        }

        h2 {
            font-size: 2rem; /* Subtítulos un poco más grandes */
            margin-bottom: 1.25rem;
            border-bottom: 1px solid rgba(138, 180, 248, 0.2); /* Línea sutil bajo los títulos de sección */
            padding-bottom: 0.75rem;
        }

        p.description {
            font-size: 1.1rem;
            color: #a0a0a0;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* Estilo para las tarjetas de clase */
        .class-card {
            background-color: #2a2a2a; /* Fondo de tarjeta más oscuro */
            border-radius: 0.6rem; /* Bordes redondeados */
            padding: 1.2rem; /* Más padding interno */
            margin-bottom: 1rem;
            cursor: pointer;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, background-color 0.2s ease-out, border-color 0.2s ease-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2); /* Sombra más sutil y limpia */
            position: relative;
            overflow: hidden;
            border: 1px solid transparent; /* Borde inicial transparente */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Espacio entre contenido y UVs */
            height: 100%; /* Asegura que todas las tarjetas en la fila tengan la misma altura */
        }

        .class-card:hover {
            transform: translateY(-3px); /* Efecto de "levantar" más sutil */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), 0 2px 6px rgba(0, 0, 0, 0.25);
            background-color: #333333; /* Ligero cambio al pasar el ratón */
        }

        .class-card.selected {
            background-color: #3a3a3a; /* Color cuando la clase está seleccionada */
            border-color: #8ab4f8; /* Borde del color de acento */
            box-shadow: 0 0 15px rgba(138, 180, 248, 0.5); /* Sombra luminosa al seleccionar */
        }

        .class-card h3 {
            font-weight: 500; /* Menos bold */
            color: #e0e0e0; /* Título de clase claro */
            margin-bottom: 0.4rem;
            font-size: 1.05rem;
            line-height: 1.3;
        }

        .class-card p {
            font-size: 0.9rem;
            color: #b0b0b0; /* Texto de descripción más suave */
            margin-bottom: 0.5rem;
        }

        .class-card .units {
            font-weight: 600;
            color: #fca3b0; /* Rojo suave para UVs */
            display: block; /* Asegura que UV tenga su propia línea si es necesario */
            margin-top: auto; /* Empuja las UVs hacia abajo en la tarjeta */
        }

        /* Indicador de selección (marca de verificación) */
        .class-card .check-icon {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            color: #8ab4f8; /* Color de acento */
            font-size: 1.6rem;
            opacity: 0;
            transform: scale(0.7);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }

        .class-card.selected .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        /* Estilos para el resumen de estado y recomendaciones */
        .summary-card, .recommendation-card {
            background-color: #2a2a2a;
            border-radius: 0.6rem;
            padding: 1.8rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease-out; /* Transición para cambios en el resumen */
            border: 1px solid #3a3a3a; /* Borde sutil */
        }

        .summary-card p, .recommendation-card p {
            font-size: 1rem;
            margin-bottom: 0.6rem;
            color: #c0c0c0;
        }

        .summary-card span {
            font-weight: 700;
            color: #8ab4f8; /* Color de acento */
            font-size: 1.05rem;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }

        .recommendation-list li {
            background-color: #333333; /* Fondo de ítem de recomendación */
            margin-bottom: 0.6rem;
            padding: 0.8rem 1.2rem;
            border-radius: 0.4rem;
            font-size: 0.95rem;
            color: #b5b5b5;
            display: flex;
            align-items: center;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2); /* Sombra interna sutil */
        }

        .recommendation-list li i {
            color: #8ab4f8;
            margin-right: 0.8rem;
            font-size: 1.1rem;
        }

        /* Botón de Reiniciar */
        #resetButton {
            background-color: #d14949; /* Rojo un poco más suave */
            color: white;
            padding: 0.8rem 1.6rem;
            border-radius: 0.4rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        #resetButton:hover {
            background-color: #b83d3d;
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }

        /* Estilos para los cuadros modales (Message Box y Confirmation Box) */
        .message-box, .confirmation-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2a2a2a;
            border: 2px solid #8ab4f8;
            border-radius: 0.75rem;
            padding: 2.2rem;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), 0 6px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 1.8rem;
            color: #e0e0e0;
            font-size: 1.1rem;
            text-align: center;
            max-width: 90%; /* Responsivo */
        }

        .message-box button, .confirmation-box button {
            background-color: #8ab4f8;
            color: #1c1c1c; /* Texto oscuro en el botón */
            padding: 0.75rem 1.8rem;
            border-radius: 0.4rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .message-box button:hover, .confirmation-box button:hover {
            background-color: #6a9ee8;
            transform: translateY(-1px);
        }

        .confirmation-box .buttons {
            display: flex;
            gap: 1.2rem;
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .container {
                padding: 1.5rem;
            }
            .grid-cols-1, .sm:grid-cols-2, .lg:grid-cols-3 {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Ajuste para tablets */
            }
            h1 {
                font-size: 2.2rem;
            }
            h2 {
                font-size: 1.7rem;
            }
            .class-card {
                padding: 1rem;
            }
            .class-card h3 {
                font-size: 1rem;
            }
            .class-card p {
                font-size: 0.85rem;
            }
            .summary-card, .recommendation-card {
                padding: 1.5rem;
            }
            .summary-card h2, .recommendation-card h2 {
                font-size: 1.6rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .grid-cols-1, .sm:grid-cols-2, .lg:grid-cols-3 {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Ajuste para móviles */
            }
            .md\:col-span-2 {
                grid-column: span 1 / span 1; /* Pila en móvil */
            }
            h1 {
                font-size: 1.8rem;
                margin-bottom: 1rem;
            }
            h2 {
                font-size: 1.4rem;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
            }
            p.description {
                font-size: 0.95rem;
                margin-bottom: 1.5rem;
            }
            .class-card {
                padding: 0.8rem;
                border-radius: 0.5rem;
            }
            .class-card h3 {
                font-size: 0.95rem;
            }
            .class-card p {
                font-size: 0.8rem;
            }
            .summary-card, .recommendation-card {
                padding: 1rem;
                border-radius: 0.5rem;
            }
            .summary-card h2, .recommendation-card h2 {
                font-size: 1.3rem;
            }
            .message-box, .confirmation-box {
                padding: 1.5rem;
                font-size: 1rem;
            }
            .message-box button, .confirmation-box button {
                padding: 0.6rem 1.4rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="font-bold text-center">Plan de Estudios - Ingeniería en Sistemas Computacionales</h1>
        <p class="description">Selecciona las clases que ya has aprobado para visualizar tu progreso, 
            estimar tu tiempo de graduación y recibir recomendaciones para tus próximas materias.</p>

                <!-- Botones centrados -->
     <div class="flex justify-center gap-4 mt-6">
    <a href="Registro_mes.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
      <strong>registro de mes</strong>
    </a>
    <a href="flujograma.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
      <strong>Flojograma</strong>
    </a>
    <a href="pagina3.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
      <strong>registro de mes</strong>
    </a>
  </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
  <!-- Columna de Resumen y Recomendaciones -->
  <div class="space-y-8"><br>
    <!-- Resumen de Progreso -->
    <div class="summary-card sticky top-8">
      <strong><h2>Resumen de Progreso</h2></strong>
      <p>Clases Aprobadas: <span id="classesTaken">0</span></p>
      <p>Unidades Valorativas Aprobadas: <span id="uvTaken">0</span> / 222</p>
      <p>Clases Restantes: <span id="classesRemaining">0</span></p>
      <p>Unidades Valorativas Restantes: <span id="uvRemaining">0</span></p>
      <p>Periodos para Graduarte (estimado): <span id="periodsRemaining">0</span></p>
      <p>Años para Graduarte (estimado): <span id="yearsRemaining">0</span></p>
      <p class="text-sm text-gray-500 mt-4">
        * Estimación basada en 4 periodos por año y 20 UV por periodo.
      </p>
    </div>

    <!-- Clases Recomendadas -->
    <div class="recommendation-card sticky top-8">
      <h2>Clases Recomendadas para matricular</h2>
      <ul id="recommendedClassesList" class="recommendation-list">
        <!-- Las clases recomendadas se cargarán aquí -->
      </ul>
      <p id="noRecommendationsMessage" class="text-gray-500 text-sm mt-4 hidden">
        ¡Felicidades! Has completado todas las clases posibles o no hay más disponibles que cumplan los requisitos.
      </p>
    </div>
  </div>

  <!-- Columna de Clases -->
  <div class="md:col-span-2"> <br>
    <center><strong><h2>Elije las clases que ya has pasado</h2></strong></center><br>
    <div id="classesContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Las clases se cargarán aquí dinámicamente -->
    </div>
  </div>
</div>
</div>
    </div>

    <!-- Message Box for alerts -->
    <div id="messageBox" class="message-box">
        <p id="messageText"></p>
        <button id="messageBoxOk">OK</button>
    </div>

    <!-- Confirmation Box for reset -->
    <div id="confirmationBox" class="confirmation-box">
        <p id="confirmationText"></p>
        <div class="buttons">
            <button id="confirmYes">Sí</button>
            <button id="confirmNo">No</button>
        </div>
    </div>

    <script type="module">
        // Estado de las clases seleccionadas
        let selectedClassIds = new Set();
        const LOCAL_STORAGE_KEY = 'studyPlanSelectedClasses'; // Clave para localStorage

        const TOTAL_UVS_GRADUATION = 222; // Total de unidades valorativas para graduarse
        const UV_PER_PERIOD_ESTIMATE = 20; // Estimado de UVs por periodo
        const PERIODS_PER_YEAR = 4; // Periodos por año

        // Mostrar la caja de mensaje personalizada
        function showMessageBox(message) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageText.textContent = message;
            messageBox.style.display = 'flex';
        }

        // Ocultar la caja de mensaje personalizada
        function hideMessageBox() {
            document.getElementById('messageBox').style.display = 'none';
        }

        // Listener para el botón OK de la caja de mensaje
        document.getElementById('messageBoxOk').addEventListener('click', hideMessageBox);

        // Mostrar la caja de confirmación personalizada
        function showConfirmationBox(message, onConfirm) {
            const confirmationBox = document.getElementById('confirmationBox');
            const confirmationText = document.getElementById('confirmationText');
            const confirmYes = document.getElementById('confirmYes');
            const confirmNo = document.getElementById('confirmNo');

            confirmationText.textContent = message;
            confirmationBox.style.display = 'flex';

            confirmYes.onclick = () => {
                confirmationBox.style.display = 'none';
                onConfirm(true);
            };

            confirmNo.onclick = () => {
                confirmationBox.style.display = 'none';
                onConfirm(false);
            };
        }

        // Datos de las clases con sus prerrequisitos (basado en el PDF y el flujo común)
        const allClasses = [
            { id: 'LL-111', name: 'Español', uv: 4, prerequisites: [] },
            { id: 'MM-111', name: 'Matemática I', uv: 5, prerequisites: [] },
            { id: 'LL-141', name: 'Inglés I', uv: 3, prerequisites: [] },
            { id: 'HH-131', name: 'Filosofía', uv: 3, prerequisites: [] },
            { id: 'LCC-111', name: 'Lab. Procesamiento de Datos I', uv: 1, prerequisites: [] },
            { id: 'CN-130-132', name: 'Área Electiva de Ciencias Naturales', uv: 3, prerequisites: [] },
            { id: 'MM-122', name: 'Geometría y Trigonometría', uv: 5, prerequisites: ['MM-111'] },
            { id: 'LL-142', name: 'Inglés II', uv: 4, prerequisites: ['LL-141'] },
            { id: 'HH-211', name: 'Sociología', uv: 3, prerequisites: [] },
            { id: 'MM-131', name: 'Cálculo I', uv: 5, prerequisites: ['MM-111'] },
            { id: 'LCC-122', name: 'Lab. Procesamiento de Datos II', uv: 1, prerequisites: ['LCC-111', 'IS-131'] },
            { id: 'IS-112', name: 'Introducción a la Computación', uv: 2, prerequisites: [] },
            { id: 'IS-131', name: 'Programación I', uv: 4, prerequisites: ['IS-112'] },
            { id: 'HH-121', name: 'Historia de Honduras', uv: 4, prerequisites: [] },
            { id: 'LL-143', name: 'Inglés III', uv: 4, prerequisites: ['LL-142'] },
            { id: 'MM-142', name: 'Cálculo II', uv: 5, prerequisites: ['MM-131'] },
            { id: 'MM-211', name: 'Estadística I', uv: 3, prerequisites: ['MM-142'] },
            { id: 'LCC-133', name: 'Lab. Procesamiento de Datos III', uv: 1, prerequisites: ['LCC-122'] },
            { id: 'IS-141', name: 'Programación II', uv: 4, prerequisites: ['IS-131'] },
            { id: 'IS-142', name: 'Estructura de Datos', uv: 3, prerequisites: ['IS-141'] },
            { id: 'MM-121', name: 'Vectores y Matrices', uv: 5, prerequisites: ['MM-122'] },
            { id: 'MM-212', name: 'Ecuaciones Diferenciales', uv: 4, prerequisites: ['MM-142', 'MM-121'] },
            { id: 'MM-222', name: 'Estadística II', uv: 3, prerequisites: ['MM-211'] },
            { id: 'FS-141', name: 'Física I', uv: 4, prerequisites: [] },
            { id: 'MM-213', name: 'Matemática Discreta', uv: 4, prerequisites: ['MM-212'] },
            { id: 'ADM-111', name: 'Administración General', uv: 4, prerequisites: [] },
            { id: 'IS-151', name: 'Programación III', uv: 4, prerequisites: ['IS-141'] },
            { id: 'IS-211', name: 'Organización de Archivos', uv: 4, prerequisites: ['IS-151', 'IS-142'] },
            { id: 'FS-212', name: 'Física II', uv: 4, prerequisites: ['FS-141'] },
            { id: 'MM-214', name: 'Métodos Numéricos', uv: 4, prerequisites: ['MM-212'] },
            { id: 'IP-343', name: 'Contabilidad General', uv: 4, prerequisites: [] },
            { id: 'IS-161', name: 'Programación IV', uv: 4, prerequisites: ['IS-151'] },
            { id: 'IS-222', name: 'Sistemas de Información', uv: 4, prerequisites: ['IS-161', 'IS-211'] },
            { id: 'RH-131', name: 'Arte/Deporte', uv: 1, prerequisites: [] },
            { id: 'IS-311', name: 'Análisis de Algoritmos', uv: 4, prerequisites: ['MM-213'] },
            { id: 'IP-413', name: 'Contabilidad de Costos', uv: 4, prerequisites: ['IP-343'] },
            { id: 'IS-313', name: 'Teoría de Bases de Datos I', uv: 4, prerequisites: ['IS-211'] }, /* Prerequisito añadido */
            { id: 'IS-312', name: 'Circuitos Digitales', uv: 4, prerequisites: [] },
            { id: 'IS-321', name: 'Buses y Periféricas', uv: 4, prerequisites: ['IS-312'] },
            { id: 'LIP-141', name: 'Dibujo Técnico', uv: 2, prerequisites: [] },
            { id: 'IS-333', name: 'Teoría de Bases de Datos II', uv: 4, prerequisites: ['IS-313'] },
            { id: 'IS-342', name: 'Ingeniería de Software I', uv: 4, prerequisites: ['IS-222'] },
            { id: 'IS-331', name: 'Equipo de Transmisión de Datos', uv: 3, prerequisites: ['IS-321'] },
            { id: 'IS-341', name: 'Tecnología de Redes Locales', uv: 4, prerequisites: ['IS-331'] },
            { id: 'IP-431', name: 'Finanzas', uv: 4, prerequisites: ['IP-413'] },
            { id: 'IS-334', name: 'Lenguajes de Programación', uv: 4, prerequisites: ['IS-222'] },
            { id: 'IS-343', name: 'Sistemas Operativos I', uv: 4, prerequisites: ['IS-222'] },
            { id: 'IS-314', name: 'Fundamentos de Informática Gráfica', uv: 3, prerequisites: ['MM-214'] },
            { id: 'IP-441', name: 'Prep. y Evaluación de Proyectos', uv: 3, prerequisites: ['IP-431'] },
            { id: 'IS-412', name: 'Ingeniería de Software II', uv: 4, prerequisites: ['IS-342'] },
            { id: 'IS-413', name: 'Seguridad de la Información', uv: 3, prerequisites: ['IS-341'] },
            { id: 'IS-324', name: 'Fundamentos de Inteligencia Artificial', uv: 3, prerequisites: ['MM-213'] },
            { id: 'IS-411', name: 'Taller de Ensamblaje I', uv: 5, prerequisites: ['IS-321'] },
            { id: 'IS-421', name: 'Programación de Sistemas Operativos', uv: 4, prerequisites: ['IS-343'] },
            { id: 'IS-332', name: 'Informática Gráfica Aplicada', uv: 4, prerequisites: ['IS-314'] },
            { id: 'IS-422', name: 'Taller de Ensamblaje II', uv: 5, prerequisites: ['IS-411'] },
            { id: 'IS-423', name: 'Sistemas Operativos II', uv: 4, prerequisites: ['IS-421'] },
            { id: 'IS-431', name: 'Administración de Centro de Cómputo', uv: 3, prerequisites: ['IS-341'] },
            { id: 'IS-432', name: 'Traductores e Intérpretes', uv: 3, prerequisites: ['IS-334'] },
            { id: 'LIP-441', name: 'Seminario de Graduación', uv: 4, prerequisites: ['IP-441', 'IS-412', 'IS-413', 'IS-422', 'IS-423', 'IS-431', 'IS-432', 'MM-222', 'FS-212', 'RH-131', 'ADM-111', 'LIP-141', 'CN-130-132', 'HH-131', 'HH-211', 'HH-121', 'LL-111', 'LL-143'] }, /* Prerequisitos para seminario: todas las materias generales y de último año */
            { id: 'IS-441', name: 'Traductores e Intérpretes II', uv: 3, prerequisites: ['IS-432'] }
        ];

        // Función para renderizar las clases en el DOM
        function renderClasses() {
            const classesContainer = document.getElementById('classesContainer');
            classesContainer.innerHTML = ''; // Limpiar el contenedor antes de renderizar

            allClasses.forEach(clase => {
                const card = document.createElement('div');
                card.id = `class-${clase.id}`; // Asignar un ID único a cada tarjeta de clase
                card.className = `class-card rounded-lg p-4 cursor-pointer relative ${selectedClassIds.has(clase.id) ? 'selected' : ''}`;
                card.innerHTML = `
                    <h3>${clase.id} - ${clase.name}</h3>
                    <p>Unidades Valorativas: <span class="units">${clase.uv}</span></p>
                    <i class="fas fa-check-circle check-icon"></i>
                `;
                card.addEventListener('click', () => toggleClassSelection(clase.id));
                classesContainer.appendChild(card);
            });
        }

        // Función para alternar la selección de una clase
        function toggleClassSelection(classId) {
            if (selectedClassIds.has(classId)) {
                selectedClassIds.delete(classId);
            } else {
                // Opcional: Impedir seleccionar si los prerrequisitos no están cumplidos
                const claseToSelect = allClasses.find(c => c.id === classId);
                const prerequisitesMet = claseToSelect.prerequisites.every(prereqId => selectedClassIds.has(prereqId));
                
                if (!prerequisitesMet) {
                    showMessageBox(`Para matricular ${claseToSelect.name}, necesitas haber aprobado primero: ${claseToSelect.prerequisites.filter(p => !selectedClassIds.has(p)).map(id => allClasses.find(c => c.id === id)?.name || id).join(', ')}.`);
                    return; // No permite la selección
                }
                selectedClassIds.add(classId);
            }
            // Actualizar la clase CSS y guardar el estado
            updateClassCardUI(classId);
            saveSelectedClasses();
            updateSummary();
            renderRecommendedClasses(); // Actualizar las recomendaciones
        }

        // Actualizar la interfaz de usuario de una tarjeta de clase específica
        function updateClassCardUI(classId) {
            const card = document.getElementById(`class-${classId}`);
            if (card) {
                if (selectedClassIds.has(classId)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            }
        }

        // Función para actualizar el resumen de progreso
        function updateSummary() {
            let classesTakenCount = selectedClassIds.size;
            let uvTakenCount = 0;

            selectedClassIds.forEach(id => {
                const clase = allClasses.find(c => c.id === id);
                if (clase) {
                    uvTakenCount += clase.uv;
                }
            });

            const classesRemainingCount = allClasses.length - classesTakenCount;
            const uvRemainingCount = TOTAL_UVS_GRADUATION - uvTakenCount;

            // Calcular el tiempo estimado para graduarse
            let periodsRemainingEstimate = 0;
            let yearsRemainingEstimate = 0;
            if (uvRemainingCount > 0) {
                periodsRemainingEstimate = Math.ceil(uvRemainingCount / UV_PER_PERIOD_ESTIMATE);
                yearsRemainingEstimate = (periodsRemainingEstimate / PERIODS_PER_YEAR).toFixed(1); // Un decimal para los años
            }
            
            document.getElementById('classesTaken').textContent = classesTakenCount;
            document.getElementById('uvTaken').textContent = uvTakenCount;
            document.getElementById('classesRemaining').textContent = classesRemainingCount;
            document.getElementById('uvRemaining').textContent = uvRemainingCount;
            document.getElementById('periodsRemaining').textContent = periodsRemainingEstimate;
            document.getElementById('yearsRemaining').textContent = yearsRemainingEstimate;

            renderRecommendedClasses(); // Asegurarse de que las recomendaciones se actualicen con el resumen
        }

        // Función para guardar las clases seleccionadas en localStorage
        function saveSelectedClasses() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(Array.from(selectedClassIds)));
                // console.log("Selecciones guardadas exitosamente en localStorage."); // Descomentar para depuración
            } catch (error) {
                console.error("Error al guardar las selecciones en localStorage:", error);
                showMessageBox("Error al guardar tu progreso localmente. El navegador puede estar en modo privado o sin espacio.");
            }
        }

        // Función para cargar las clases seleccionadas desde localStorage
        function loadSelectedClasses() {
            try {
                const storedClasses = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (storedClasses) {
                    selectedClassIds = new Set(JSON.parse(storedClasses));
                    // console.log("Selecciones cargadas exitosamente desde localStorage:", selectedClassIds); // Descomentar para depuración
                } else {
                    // console.log("No hay selecciones guardadas en localStorage."); // Descomentar para depuración
                    selectedClassIds.clear();
                }
            } catch (error) {
                console.error("Error al cargar las selecciones desde localStorage:", error);
                showMessageBox("Error al cargar tu progreso localmente. Puede que los datos estén corruptos.");
                selectedClassIds.clear(); // Limpiar si hay un error de carga
            }
            renderClasses();
            updateSummary();
            renderRecommendedClasses(); // Cargar recomendaciones al iniciar
        }

        // Función para reiniciar la selección
        function resetSelection() {
            showConfirmationBox("¿Estás seguro de que quieres reiniciar todas tus selecciones? Esto borrará tu progreso.", (confirmed) => {
                if (confirmed) {
                    selectedClassIds.clear();
                    saveSelectedClasses(); // Guardar el estado vacío
                    renderClasses(); // Re-renderizar para reflejar el cambio
                    updateSummary(); // Actualizar el resumen
                    renderRecommendedClasses(); // Actualizar las recomendaciones
                    showMessageBox("¡Selecciones reiniciadas con éxito!");
                }
            });
        }

        // Función para renderizar clases recomendadas
        function renderRecommendedClasses() {
            const recommendedList = document.getElementById('recommendedClassesList');
            const noRecommendationsMessage = document.getElementById('noRecommendationsMessage');
            recommendedList.innerHTML = ''; // Limpiar la lista

            const recommended = [];
            allClasses.forEach(clase => {
                // Si la clase no ha sido tomada y no es el seminario de graduación (se recomienda al final)
                if (!selectedClassIds.has(clase.id) && clase.id !== 'LIP-441') { // Evitar recomendar seminario prematuramente
                    // Verificar si todos los prerrequisitos están cumplidos
                    const prerequisitesMet = clase.prerequisites.every(prereqId => selectedClassIds.has(prereqId));
                    if (prerequisitesMet) {
                        recommended.push(clase);
                    }
                }
            });

            // Ordenar las recomendaciones: primero las de UV más bajas para "limpiar" prerrequisitos más rápido, o por orden alfabético
            recommended.sort((a, b) => a.uv - b.uv || a.id.localeCompare(b.id));

            if (recommended.length > 0) {
                noRecommendationsMessage.classList.add('hidden');
                recommended.slice(0, 8).forEach(clase => { // Mostrar solo las primeras 8 recomendaciones para no abrumar
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<i class="fas fa-book"></i><span>${clase.id} - ${clase.name} (${clase.uv} UV)</span>`;
                    recommendedList.appendChild(listItem);
                });
                if (recommended.length > 8) {
                    const moreItem = document.createElement('li');
                    moreItem.innerHTML = `<i class="fas fa-ellipsis-h"></i><span>...y más clases disponibles</span>`;
                    recommendedList.appendChild(moreItem);
                }
            } else {
                // Si todas las clases han sido tomadas y el seminario de graduación no ha sido tomado
                if (!selectedClassIds.has('LIP-441') && allClasses.every(clase => selectedClassIds.has(clase.id) || clase.id === 'LIP-441')) {
                     const seminario = allClasses.find(c => c.id === 'LIP-441');
                     if (seminario && seminario.prerequisites.every(prereqId => selectedClassIds.has(prereqId))) {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `<i class="fas fa-graduation-cap"></i><span>¡Estás listo para el Seminario de Graduación! (${seminario.uv} UV)</span>`;
                        recommendedList.appendChild(listItem);
                        noRecommendationsMessage.classList.add('hidden');
                     } else {
                        noRecommendationsMessage.classList.remove('hidden');
                     }
                } else {
                    noRecommendationsMessage.classList.remove('hidden');
                }
            }
        }

        // Inicializar la aplicación cuando el DOM esté completamente cargado
        document.addEventListener('DOMContentLoaded', () => {
            loadSelectedClasses(); // Cargar las clases al inicio
            document.getElementById('resetButton').addEventListener('click', resetSelection);
        });
    </script>
</body>
</html>
